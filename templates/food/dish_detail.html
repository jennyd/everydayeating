{% extends "food/base.html" %}
{% load humanize %}

{% block content %}

    <h1>{{ dish.name }}</h1>
    <p>
    {% if dish.unit == "items" %}
        {{ dish.quantity|apnumber|intcomma }}
    {% else %}
        {{ dish.quantity|intcomma }}{{ dish.unit }} of
    {% endif %}
     {{ dish.name }}, cooked: {{ dish.date_cooked|naturalday }}.
    ({{ dish.calories|floatformat:0|intcomma }} calories)<p/>
    
    Ingredients:
        <table>
            {% for amount in dish.contained_comestibles_set.all %}
                 <tr>
                {% if amount.contained_comestible.unit == "items" %}
                    <td>{{ amount.quantity|apnumber|intcomma }}</td>
                    <td></td>
                {% else %}
                    <td>{{ amount.quantity|intcomma }}{{ amount.contained_comestible.unit }}</td>
                    <td>of</td>
                {% endif %}
                {% if amount.contained_comestible.is_dish %}
                    <td><a href="{% url dish_detail amount.contained_comestible.id %}">{{ amount.contained_comestible }}</a></td>
                {% else %}
                    <td><a href="{% url ingredient_detail amount.contained_comestible.id %}">{{ amount.contained_comestible }}</a></td>
                {% endif %}
                <td>({{ amount.calories|floatformat:0|intcomma }} calories)</td>
                </tr>
            {% empty %}
                <tr><td>This dish doesn't have any ingredients.</td></tr>
            {% endfor %}
        </table>

    </br>
    <a href="{% url dish_edit dish.id %}">Edit this dish</a><p/>

    <h3>Dishes containing this dish</h3>

    <p>
    {% for amount in dish.comestible.containing_dishes_set.all %}
        <a href="{% url dish_detail amount.containing_dish.id %}">{{ amount.containing_dish }}</a> ({{ amount.quantity }} {{ amount.contained_comestible.unit }})</br>
    {% empty %}
        This dish isn't in any dishes.
    {% endfor %}
    </p>

    <h3>Meals containing this dish</h3>

    <p>
    {% for eating in dish.comestible.eating_set.all %}
        <a href="{% url meal_detail eating.meal.id %}">{{ eating.meal|capfirst }}</a> ({{ eating.quantity }} {{ eating.comestible.unit }})</br>
    {% empty %}
        This dish isn't in any meals.
    {% endfor %}
    </p>

{% endblock content %}
