{% extends "food/base.html" %}
{% load humanize %}

{% block style %}

    #nav-dishes {font-size: larger; font-weight: bold;}

{% endblock style %}

{% block title %}

    {{ block.super }} Dish detail: {{ dish.name }}

{% endblock title %}

{% block content %}

    <h1>{{ dish.name }}</h1>

    <p>
    {% if dish.unit == "items" %}
        {{ dish.quantity|apnumber|intcomma }} {{ dish.name }}{{ dish.quantity|pluralize }},
    {% else %}
        {{ dish.quantity|intcomma }}{{ dish.unit }},
    {% endif %}
    cooked: {{ dish.date_cooked|naturalday }} by {{ dish.pretty_cooks }}
    ({{ dish.calories|floatformat:0|intcomma }} calories) <a href="{% url dish_delete dish.id %}">Delete this dish</a><br />
    {% if dish.recipe_url %}
        <a href="{{ dish.recipe_url }}">Link to recipe</a>
    {% endif %}
    <p/>
    
    <h2>Ingredients:</h2>

    <table>
    <tr>
    <th>Ingredient</th>
    <th>Quantity</th>
    <th>Calories</th>
    </tr>
    {% for amount in dish.amount_set.all %}
        <tr>
        {% if amount.contained_comestible.is_dish %}
            <td><a href="{% url dish_detail amount.contained_comestible.id %}">{{ amount.contained_comestible }}</a></td>
        {% else %}
            <td><a href="{% url ingredient_detail amount.contained_comestible.id %}">{{ amount.contained_comestible }}</a></td>
        {% endif %}
        {% if amount.contained_comestible.unit == "items" %}
            <td>{{ amount.quantity|apnumber|intcomma }}</td>
        {% else %}
            <td>{{ amount.quantity|intcomma }}{{ amount.contained_comestible.unit }}</td>
        {% endif %}
        <td class="calories">{{ amount.calories|floatformat:0|intcomma }} calories</td>
        </tr>
    {% empty %}
        <tr><td>This dish doesn't have any ingredients.</td></tr>
    {% endfor %}
    </table>

    <ul>
    <li><a href="{% url dish_edit dish.id %}">Edit this dish</a></li>
    <li><a href="{% url dish_multiply dish.id %}">Multiply quantities</a></li>
    </ul>

    <h3>Dishes containing this dish</h3>

    <p>
    {% for amount in dish.comestible.containing_dishes_set.all %}
        <a href="{% url dish_detail amount.containing_dish.id %}">{{ amount.containing_dish }}</a> ({{ amount.quantity }} {{ amount.contained_comestible.unit }})<br />
    {% empty %}
        This dish isn't in any dishes.
    {% endfor %}
    </p>

    <h3>Portions of this dish</h3>

    <table>
    {% for portion in dish.comestible.portion_set.all %}
        <tr>
        <td>{{ portion.quantity }}{{ portion.comestible.unit }}</td>
        <td>for <a href="{% url meal_detail portion.meal.id %}">{{ portion.meal|capfirst }}</a></td>
        <td>({{ portion.calories|floatformat:0|intcomma }} calories)</td>
        </tr>
        <tr>
        <td>{{ dish.get_remaining_quantity|floatformat:0|intcomma }}{{ dish.unit }}</td>
        <td>not yet assigned<td>
        </tr>
    {% empty %}
        <tr><td>This dish doesn't have any portions yet.</td></tr>
        <tr><td>{{ dish.get_remaining_quantity|floatformat:0|intcomma }}{{ dish.unit }} not yet assigned<td></tr>
    {% endfor %}
    </table>

    <p>
        <a href="{% url dish_duplicate dish.id %}">Cook this dish again</a>
    </p>

{% endblock content %}
